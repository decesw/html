<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Query Service - GeodiQueryJS</title>
    <link rel="stylesheet" href="https://getbootstrap.com/docs/3.3/dist/css/bootstrap.min.css" />
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://getbootstrap.com/docs/3.3/dist/js/bootstrap.min.js"></script>

    <script src="https://servis2.dece.com.tr/GUI/js/GeodiQueryJS.js"></script>
    <link rel="stylesheet" href="https://servis2.dece.com.tr/GUI/css/GeodiStyle.css" />

    <script>
        //copy($("#dlvSummaryTemplate").html().replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"'+\n'"))
        //github script load
        function loadScripts(scripts, appendTo) {
            appendTo = appendTo || "body";
            (function recurse(i) {
                if (undefined === scripts[i]) return;
                let src = scripts[i];
                let script = document.createElement('script');
                script.type = 'text/javascript';
                if (script.readyState) { //IE
                    script.onreadystatechange = () => {
                        if (script.readyState == 'loaded' || script.readyState == 'complete') {
                            script.onreadystatechange = null;
                            setTimeout(() => {
                                recurse(++i);
                            }, 1);
                        }
                    };
                } else { //Others
                    script.onload = () => {
                        setTimeout(() => {
                            recurse(++i);
                        }, 1);
                    };
                }
                script.src = src;
                document.getElementsByTagName(appendTo)[0].appendChild(script);
            })(0);
        }
        if (!window.jQuery)
            loadScripts(["https://code.jquery.com/jquery-2.1.3.min.js", "https://getbootstrap.com/docs/3.3/dist/js/bootstrap.min.js", "https://servis2.dece.com.tr/GUI/js/GeodiQueryJS.js"])
    </script>


    <style>
        .documentViewFrame {
            display: inline-block;
            white-space: normal;
            max-width: 250px;
            padding: 4px;
            padding-left: 8px;
            overflow: auto;
            font-size: 13px;
            font-family: arial, sans-serif;
        }

        h3 {
            background-color: #ddd;
            padding: 5px;
        }

        .key {
            color: red;
        }

        .split {
            color: red;
        }

        .value {
        }

        .form-group {
            margin-bottom: 5px !important;
        }

        .control-label {
            text-align: left !important;
        }

        .tab-pane, .panel-collapse {
            padding: 5px;
        }

        .panel-title a {
            width: 100%;
            display: block;
        }

        #DLV {
            width: 550px;
            display: block;
        }

            #DLV .list-item {
                white-space: inherit;
                overflow: inherit;
                margin-bottom: 20px;
            }

        .SummaryLinks {
            margin-top: 10px;
        }

        .inLink {
            color: #0000EE;
            cursor: pointer;
        }
    </style>

    <script>
        function json2html(json) {
            var i, ret = "";
            ret += "<ul>";
            for (i in json)
                if (i != "parentdata" && typeof json[i] !== "function") {
                    ret += "<li><span class=key>" + i + "</span>";
                    if (typeof json[i] === "object") ret += json2html(json[i]);
                    else ret += "<span class=split>:</span> <span class=value>" + json[i] + "</span>";
                    ret += "</li>";
                }
            ret += "</ul>";
            return ret;
        }
    </script>
</head>
<body>




    <div class="container">

        <div class="row">
            <h3>Query Service - GeodiQueryJS</h3>
        </div>

        <div class="row">
            <div class="col-xs-12">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-md-1" for="serverUrl">Geodi Url </label>
                        <div class="col-md-5">
                            <input class="form-control" type="text" name="serverUrl" id="serverUrl" Value="https://servis2.dece.com.tr">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1" for="token">Token </label>
                        <div class="col-md-5">
                            <input class="form-control" type="text" name="token" id="token" value="EAAAACre%2FTWEGyFZI6ER8Y%2FuifIsGfcRFA17BQwEZkP9iBftv%2FKrOKDZKVmvcA47r22iq95qMfa4nYZf7X8iOlt%2FSJ08Jf1emG4ESuEaKnX7wc0Z43O5KO6UHM5FBFTd56tgjm2hCNVqXZJYvuotdtc1aSd3fOY1WWVBv%2FXsj2lozIwmGk7jheOhJzkHpuMHEiht9GxYeQpcdM1cxF0OIzJSaSgFkEvKBAcHs8%2BNktrgKkRC7GfdRhSTvsb7R7Y%2BGpZG%2FvaRTdZg7XK9vjYKiy646LEt5axE1YStYdoOAijGU802Sg5IVNLOYoFM0Lwlw0WsB9YJ2krc1IKzEZIgZ77h8C1mjbdyHHOwJwL%2B4kl81PWkuD7fRDR74QinJ6F7zjCipOblqEJzJt5m5FO6XaLKIbQcB2p8qKmmnUOMl5MPmQj51S0KxBnajZ%2FZJ6%2FeNQGAbQ%2BRI8Kih%2BKu7T3iU8Xvj1Vvk4Fr8pjg1M2cqPviyA%2Fb7xD%2FH5tUopnZExa6H%2FF4rf%2BmICKQCR%2FeE7NJfUeQHOY%3D">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1" for="wsName">wsName</label>
                        <div class="col-md-5">
                            <input type="text" class="form-control" name="wsName" id="wsName" placeholder="Please enter workspace name." value="3003-EN-Travel & Food">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1" for="serverUrl">Query </label>
                        <div class="col-md-5">
                            <input id="q" class="form-control" type="text" onkeypress="if (event.keyCode == 13) Run();">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1">&nbsp</label>
                        <div class="btn-group col-md-11" role="group">
                            <button type=button onclick='Run()' class="btn btn-default">Run</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <br>
        <div id=tabs>
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#response">GeodiQueryJS GUI Samples</a></li>
                <li><a data-toggle="tab" href="#jsonResponse">JSON Response</a></li>
                <li><a data-toggle="tab" href="#htmlCode">Sample HTML Templates</a></li>
                <li><a data-toggle="tab" href="#scriptCode">Javascript Code</a></li>
            </ul>

            <div class="tab-content">
                <div id="response" class="tab-pane fade in active">
                    <div class=firstTime>
                        <p><br>Click To <a href="javascript:Run()">Run</a></p>
                    </div>
                    <div id="responseArea" class="panel-group" style="display:none">


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#responseArea" href="#collapse1">DLV Horizantal</a>
                                </h4>
                            </div>
                            <div id="collapse1" class="panel-collapse collapse in">
                                <div id=DLVHor1>

                                </div>
                            </div>
                        </div>


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#responseArea" href="#collapse2">DLV</a>
                                </h4>
                            </div>
                            <div id="collapse2" class="panel-collapse collapse">
                                <div id=DLV>

                                </div>
                            </div>
                        </div>


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#responseArea" href="#collapse3">Simple</a>
                                </h4>
                            </div>
                            <div id="collapse3" class="panel-collapse collapse">
                                <div id=DLVSimple>

                                </div>
                            </div>
                        </div>



                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#responseArea" href="#collapse4">Images</a>
                                </h4>
                            </div>
                            <div id="collapse4" class="panel-collapse collapse">
                                if you don't see a content, try querying <a href="javascript:$('#q').val('*.jpg');Run();">"* .jpg"</a>
                                <div id=DLVImages>

                                </div>
                            </div>
                        </div>


                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#responseArea" href="#collapse5">Carousel - For Images</a>
                                </h4>
                            </div>
                            <div id="collapse5" class="panel-collapse collapse">
                                if you don't see a content, try querying <a href="javascript:$('#q').val('*.jpg');Run();">"* .jpg"</a>
                                <div id=myCarousel style="width:250px">

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div id="jsonResponse" class="tab-pane fade">
                    <p><br>Click To <a href="javascript:Run()">Run</a></p>
                </div>

                <div id="htmlCode" class="tab-pane fade">
                    <pre id=htmlCode1></pre>
                </div>

                <div id="scriptCode" class="tab-pane fade">
                    <pre id=scriptCode1></pre>
                </div>

            </div>
        </div>


    </div>

    <div id=templates style="display:none">

        <script id=tmpSimple type="dece-template">
            <d:r data="data">
                <li>
                    {{ data.DisplayName }}  -  {{ data.AdditionalValues.Date }} <br>
                    <span class="SummaryText __textclass geodiFormatable" contentid="{{data.ContentIdentifier}}">{{data.Summary}}</span>
                </li>
            </d:r>
        </script>


        <script id=onlyImages type="dece-template">
            <d:r data="data">
                <d:r visible="(data.DocStatus&8)==8/*hasPreview*/">
                    <a href="{{data.GetHref()}}" target="_blank">
                        <img src="{{context.ResolveUrl('~/GeodiJSONService?op=getContentThumbnail&ContentIdentifier=' + data.RedirId + '&wsName=' + HttpUtility.UrlEncode(context.Options.Query.wsName) + '&rnd=' + window.___DomStartDate, false) }}" border=0 title="{{data.DisplayName}}" />
                    </a>
                </d:r>
            </d:r>
        </script>

        <script id=crouselTemplate type="dece-template">
            <d:r visible="data && data.length&gt;0 ">
                <div id="crs_{{context.targetDom.attr('id')}}" class="carousel slide" data-ride="carousel">


                    <ol class="carousel-indicators">
                        <d:r data="data">
                            <d:r visible="(data.DocStatus&8)==8/*hasPreview*/">
                                <li data-target="#crs_{{context.targetDom.attr('id')}}" data-slide-to="{{data.repeaterIndex}}" {{data.repeaterIndex ==0? "class=active":""}}></li>
                            </d:r>
                        </d:r>
                    </ol>

                    <div class="carousel-inner">
                        <d:r data="data">
                            <d:r visible="(data.DocStatus&8)==8/*hasPreview*/">
                                <div class="item{{data.repeaterIndex ==0? " active":""}}">
                                    <a href="{{data.GetHref()}}" target="_blank">
                                        <img width=300px src="{{context.ResolveUrl('~/GeodiJSONService?op=getContentThumbnail&ContentIdentifier=' + data.RedirId + '&wsName=' + HttpUtility.UrlEncode(context.Options.Query.wsName) + '&rnd=' + window.___DomStartDate, false) }}" border=0 title="{{data.DisplayName}}" />
                                        <div class="carousel-caption">
                                            {{data.DisplayName}}
                                        </div>
                                    </a>
                                    <div style="background-color:#666;color:#fff;padding:5px;">{{data.DisplayName}}</div>
                                </div>
                            </d:r>
                        </d:r>
                    </div>

                    <a class="left carousel-control" href="#crs_{{context.targetDom.attr('id')}}" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="#crs_{{context.targetDom.attr('id')}}" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                        <span class="sr-only">Next</span>
                    </a>

                </div>
        </script>
    </div>

    <script id="queryScript">


        function Run() {
            $("#responseArea").show();
            $(".firstTime").remove();


            $("#DLV").empty();
            $("#DLVHor1").empty();
            $("#DLVSimple").empty();
            $("#DLVImages").empty();
            $("#myCarousel").empty();

            //https://servis2.dece.com.tr/GUI/js/GeodiQueryJS.js included
            var q = new GeodiQuery();
            q.wsName = $("#wsName").val();
            q.EndIndex = 8;
            q.ServerUrl = $("#serverUrl").val();
            q.Token = $("#token").val();
            q.SearchString = $("#q").val();
            q.UseRank = true;
            if (!HttpUtility.ResolveUrl)
                HttpUtility.ResolveUrl = q.ResolveUrl;
            /*
			//multiplequery
				RenderDLV({ Query: q, TargetDiv: "#DLV" } )
				RenderDLV({ Query: q, TargetDiv: "#DLVSimple", Template :$("#tmpSimple") } )
				RenderDLV({Query: q, TargetDiv: "#DLVImages",  Template :$("#onlyImages") } )
				RenderDLV({ Query: q, TargetDiv: "#myCarousel", Template :$("#crouselTemplate") } )
				RenderDLV({ Query: q, TargetDiv: "#DLVHor1" })
			*/

            //single query multi render
            RenderDLV({
                Query: q, TargetDiv: "#DLV",
                MultipleTarget: [
					{ TargetDiv: "#DLVSimple", Template: $("#tmpSimple") },
					{ TargetDiv: "#DLVImages", Template: $("#onlyImages") },
					{ TargetDiv: "#myCarousel", Template: $("#crouselTemplate") },
					{ TargetDiv: "#DLVHor1", TemplateSelector: window.TemplateSelectors.DefaultDLV_Hor }
                ],
                OnEndRender: function (args) {
                    $("#jsonResponse").html(json2html(args.Data));
                }
            })

        }

        //Default Template Commands
        window._PSCC = {
            Command: function (cmd) {
                if (cmd.Command == "OpenWindow" || cmd.Command == "OpenView" || cmd.Command == "Download")
                    window.open(cmd.Url);
            }
        }

    </script>

    <script>
        function jqLoad() {
            if (!window.jQuery) {
                window.setTimeout(jqLoad, 100);
                return;
            }
            $(document).ajaxError(function (event, data, settings) {
                var txt = data.status + ": " + data.statusText + " " + data.responseText;
                alert(txt);
            });
            $("#htmlCode1").text($("#templates").html());
            $("#scriptCode1").text($("#queryScript").html());
        }
        jqLoad();
    </script>

</body>
</html>