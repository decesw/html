<html>
<head>
    <title>GEODI Javascript Token Api</title>
   <link rel="stylesheet" href="https://getbootstrap.com/docs/3.3/dist/css/bootstrap.min.css" />
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://getbootstrap.com/docs/3.3/dist/js/bootstrap.min.js"></script>
	<script>
	
	function loadScripts(scripts, appendTo) {
		  appendTo = appendTo || "body";
			(function recurse(i) {
			  if (undefined === scripts[i]) return;
			  let src = scripts[i];
			  let script = document.createElement('script');
			  script.type = 'text/javascript';
			  if (script.readyState) { //IE
				script.onreadystatechange = () => {
				  if (script.readyState == 'loaded' || script.readyState == 'complete') {
					script.onreadystatechange = null;
					setTimeout(() => {
					  recurse(++i);
					}, 1);
				  }
				};
			  } else { //Others
				script.onload = () => {
				  setTimeout(() => {
					recurse(++i);
				  }, 1);
				};
			  }
			  script.src = src;
			  document.getElementsByTagName(appendTo)[0].appendChild(script);
			})(0);
	}
		if(!window.jQuery)
			loadScripts(["https://code.jquery.com/jquery-2.1.3.min.js","https://getbootstrap.com/docs/3.3/dist/js/bootstrap.min.js"])
	</script>


    <style>
        .key {
            color: red;
        }

        .split {
            color: red;
        }

        .value {
        }

        .form-group {
            margin-bottom: 5px !important;
        }

        .control-label {
            text-align: left !important;
        }

        .scriptView {
            clear: left;
            font-size: 10pt;
            max-height: 750px;
            min-height: 100px;
            display: none;
        }

        .txtScript {
            min-height: 400px;
            margin-left: 0px;
        }
    </style>

    <script>
		$(document).ajaxError(function (event, data, settings) {

			var txt = data.status + ": " + data.statusText + " " + data.responseText;
			alert(txt);
		});
        function UrlEncode(val) {
            return window.encodeURIComponent ? window.encodeURIComponent(val) : val.replace(/&/g, '%26');
        }

        function ShowHideScript(target) {

            if ($(target).is(":visible"))
                $(target).hide();
            else
                $(target).show();
        }
    </script>
</head>
<body>
    <div class="alert alert-warning alert-dismissable fade in">
        <a href="javascript:void(0)" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        <strong>Warning!</strong> Some features such as local file upload may not work or display properly due to browsers or previews.
    </div>
    <div class="container">
        
        <script id="tokenGUIScript">
            function feedToggle() {
                if ($("#feed").is(":checked"))
                    $(".feedForm").show();
                else
                    $(".feedForm").hide();
            }
        </script>
        <script id="tokenScript">
            var TokenTarget = {
                Feed: 1,
                Query: 2,
                Recognize: 4,
                WsInfo: 8,
				ClientToken:16,
				Any:256
            }

            function GetToken() {
                var url = $("#serverUrl").val() + "/TokenHandler?op=CreateTokenForUser";

                var data = {
                    Username: $("#usr").val(),
                    Password: $("#psw").val(),
                    TokenTarget: 0
                };

                var tokenTarget = 0;
                if ($("#query").is(":checked")) data.TokenTarget |= TokenTarget.Query;
                if ($("#recognize").is(":checked")) data.TokenTarget |= TokenTarget.Recognize;
                if ($("#wsInfo").is(":checked")) data.TokenTarget |= TokenTarget.WsInfo;
				if ($("#chkClienToken").is(":checked")) data.TokenTarget |= TokenTarget.ClientToken;
				
                if ($("#feed").is(":checked")) {
                    data.TokenTarget |= TokenTarget.Feed;
                    data.wsName = $("#feedWsName").val();
                    data.enumeratorID = $("#enumeratorID").val();
                }

                $("#token").val('');
                $.post(url, data,
                    function (data) {
                        $("#token").val(data);
                    });
            }
        </script>
        <div class="row"><h3>Token API</h3></div>
        <div class="row">
            <div class="col-xs-12">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-md-1" for="serverUrl">Geodi Url </label>
                        <div class="col-md-5">
                            <input class="form-control" type="text" name="serverUrl" id="serverUrl" Value="http://127.0.0.1:3323">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1" for="usr">Username </label>
                        <div class="col-md-5">
                            <input class="form-control" type="text" id="usr">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1" for="psw">Password </label>
                        <div class="col-md-5">
                            <input class="form-control" type="password" id="psw">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <div class="col-md-5">
                            <input type="checkbox" id="query" checked> <span>Query</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <div class="col-md-5">
                            <input type="checkbox" id="recognize" checked> <span>Recognize</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <div class="col-md-5">
                            <input type="checkbox" id="wsInfo" checked> <span>Workspace Info</span>
                        </div>
                    </div>
					 <div class="form-group">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <div class="col-md-5">
                            <input type="checkbox" id="chkClienToken" checked> <span>Client Token</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <div class="col-md-5">
                            <input type="checkbox" id="feed" onclick="feedToggle();"> <span>Feed</span>
                        </div>
                    </div>
                    <div class="form-group feedForm" style="display:none">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <label class="control-label col-md-1" for="feedWsName">Workspace Name</label>
                        <div class="col-md-4">
                            <input class="form-control" type="text" id="feedWsName" />
                        </div>
                    </div>
                    <div class="form-group feedForm" style="display:none">
                        <label class="control-label col-md-1">&nbsp;</label>
                        <label class="control-label col-md-1" for="enumeratorID">Enumerator ID</label>
                        <div class="col-md-4">
                            <input class="form-control" type="text" id="enumeratorID" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-4">&nbsp;</label>
                        <div class="col-md-2">
                            <button type=button class="btn btn-default form-control" onclick="GetToken();">Create</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-md-1" for="recognizeInput">Token </label>
                        <div class="col-md-5">
                            <textarea type="text" class="form-control" id="token"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <a href="javascript:void(0)" onclick="ShowHideScript('#tokenScriptDiv')">Show/Hide Script</a><br />
        <textarea id="tokenScriptDiv" class="row scriptView txtScript form-control" readonly></textarea>

        <script>
            $("#tokenScriptDiv").html($("#tokenScript").html());
        </script>
    </div>
</body>
</html>